---
name: Scheduled Python Script for GSO
on:
  # push:
  #  branches: [ master ] 
  schedule:
    - cron: '15 * * * *' 
  workflow_dispatch:  # Allows manual trigger from GitHub UI
  
jobs:
  run-python-script:
    runs-on: ubuntu-latest
    name: Run Python Script
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0  # Fetch all history for proper git operations
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.9
        
    - name: Install dependencies
      run: |
        pip install --upgrade pip
        pip install pandas requests pytz urllib3
        
    - name: Run Python Script and Commit Changes
      run: |
        python gso_auto.py
        
    - name: Commit and Push Changes
      run: |
        cd data_gso
        git config --local user.email "booluckgmie@gmail.com"
        git config --local user.name "booluckgmie"
        git add .
        
        # Check if there are changes to commit
        if git diff-index --quiet HEAD --; then
          echo "No changes to commit"
          exit 0
        else
          git commit -m "Update data - $(date +'%Y-%m-%d %H:%M:%S')"
          git pull --rebase origin master
          git push origin master
          echo "Changes committed and pushed successfully"
        fi
      continue-on-error: false